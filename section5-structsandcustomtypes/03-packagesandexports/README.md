the code cleaned up from earlier comments and explanations